# 여왕 생성 개선 보고서

**작성일**: 2026-01-15  
**목적**: 무분별한 여왕 생성을 방지하여 리소스 효율성 향상

---

## ? 개선 완료 사항

### 문제점
- 여왕이 리소스가 부족한 상황에서도 무조건 생성됨
- 기지당 1개 규칙만 있어서 리소스 부족 시에도 생성을 시도
- 여러 곳에서 동시에 여왕 생성을 시도할 수 있음

### 개선 내용

#### 1. **production_manager.py - _produce_queen() 메서드**

**개선 전**:
- 기지당 1개 여왕만 체크
- 리소스 여유 확인 없음
- 일꾼 수 고려 없음

**개선 후**:
- ? **리소스 여유 확인**: Minerals >= 200, Gas >= 100
- ? **일꾼 수 확인**: 기지당 최소 8명 일꾼 필요
- ? **Supply 여유 확인**: 최소 10 supply 버퍼 필요
- ? **Hatchery 상태 확인**: ready & idle & orders 없음
- ? **중복 생산 방지**: 이미 생산 중인 여왕 체크

#### 2. **queen_manager.py - manage_queens() 메서드**

**개선 전**:
- 여왕이 없으면 리소스만 체크하고 생성

**개선 후**:
- ? **Spawning Pool 확인**: 필수 건물 존재 확인
- ? **리소스 여유 확인**: Minerals >= 200, Gas >= 100
- ? **일꾼 수 확인**: 최소 8명 일꾼 필요 (첫 여왕)
- ? **Hatchery 상태 확인**: ready & idle & orders 없음

#### 3. **unit_factory.py - _produce_queen() 메서드**

**개선 전**:
- 기지당 1개 여왕만 체크

**개선 후**:
- ? **리소스 여유 확인**: Minerals >= 200, Gas >= 100
- ? **일꾼 수 확인**: 기지당 최소 8명 일꾼 필요
- ? **Supply 여유 확인**: 최소 10 supply 버퍼 필요
- ? **Hatchery 상태 확인**: ready & idle & orders 없음

#### 4. **production_manager.py - Serral Build Order**

**개선 전**:
- Supply 20에 도달하면 무조건 여왕 생성

**개선 후**:
- ? **리소스 여유 확인**: Minerals >= 200, Gas >= 100
- ? **일꾼 수 확인**: 기지당 최소 8명 일꾼 필요
- ? **Hatchery 상태 확인**: orders 없음

---

## ? 개선 효과

### 리소스 효율성

| 상황 | 개선 전 | 개선 후 |
|-----|---------|---------|
| **리소스 부족 시** | 여왕 생산 시도 | 생산 건너뛰기 ? |
| **일꾼 부족 시** | 여왕 생산 시도 | 생산 건너뛰기 ? |
| **Supply 부족 시** | 여왕 생산 시도 | 생산 건너뛰기 ? |
| **Hatchery 사용 중** | 여왕 생산 시도 | 생산 건너뛰기 ? |

### 전략적 우선순위

- ? 일꾼 생산 우선: 일꾼이 부족하면 여왕 생산 지연
- ? 리소스 관리: 여왕 생산 전 리소스 여유 확인
- ? 유닛 생산 우선: Supply가 부족하면 전투 유닛 우선

---

## ? 적용된 조건

### 여왕 생산 조건 (모든 위치에서 일관되게 적용)

1. **필수 건물**: Spawning Pool 존재
2. **여왕 수**: 기지당 1개 미만
3. **리소스 여유**:
   - Minerals >= 200
   - Gas >= 100
4. **일꾼 수**: 기지당 최소 8명 일꾼
5. **Supply 여유**: 최소 10 supply 버퍼 (일부 위치)
6. **Hatchery 상태**: ready & idle & orders 없음

---

## ? 개선된 로직 흐름

### 여왕 생산 결정 프로세스

```
1. 기지당 여왕 수 체크
   ├─ 여왕 수 >= 기지 수 → 생산 안 함 ?
   └─ 여왕 수 < 기지 수 → 다음 단계

2. 필수 건물 체크
   ├─ Spawning Pool 없음 → 생산 안 함 ?
   └─ Spawning Pool 있음 → 다음 단계

3. 리소스 여유 체크
   ├─ Minerals < 200 → 생산 안 함 ?
   ├─ Gas < 100 → 생산 안 함 ?
   └─ 리소스 충분 → 다음 단계

4. 일꾼 수 체크
   ├─ 일꾼 < 기지수 * 8 → 생산 안 함 ?
   └─ 일꾼 충분 → 다음 단계

5. Supply 여유 체크 (일부 위치)
   ├─ Supply 여유 < 10 → 생산 안 함 ?
   └─ Supply 충분 → 다음 단계

6. Hatchery 상태 체크
   ├─ Not ready → 생산 안 함 ?
   ├─ Not idle → 생산 안 함 ?
   ├─ Orders 있음 → 생산 안 함 ?
   └─ Ready & Idle & Orders 없음 → 여왕 생산 ?
```

---

## ? 수정된 파일

### 주요 수정 파일

1. **wicked_zerg_challenger/production_manager.py**
   - `_produce_queen()` 메서드 개선
   - Serral Build Order 여왕 생산 개선

2. **wicked_zerg_challenger/queen_manager.py**
   - `manage_queens()` 메서드 개선

3. **wicked_zerg_challenger/unit_factory.py**
   - `_produce_queen()` 메서드 개선

---

## ? 검증 체크리스트

### 개선 사항 확인

- [x] 리소스 부족 시 여왕 생산 안 함
- [x] 일꾼 부족 시 여왕 생산 안 함
- [x] Supply 부족 시 여왕 생산 안 함
- [x] Hatchery 사용 중 여왕 생산 안 함
- [x] 기지당 1개 여왕 규칙 유지
- [x] 모든 여왕 생산 위치에서 일관된 조건 적용

---

## ? 예상 효과

### 리소스 효율성 향상

- ? 여왕 생산 시 리소스 여유 확인 → 불필요한 리소스 낭비 방지
- ? 일꾼 생산 우선 → 경제 성장 가속화
- ? Supply 여유 확인 → 전투 유닛 생산 우선

### 전략적 개선

- ? 리소스 부족 시 전투 유닛 생산 우선
- ? 일꾼 부족 시 일꾼 생산 우선
- ? 적절한 타이밍에 여왕 생산 → Larva inject 효율 향상

---

**개선 완료**: ? **무분별한 여왕 생성을 방지하는 로직이 적용되었습니다**

**다음 단계**: 게임 실행하여 여왕 생산 로직이 올바르게 동작하는지 확인
