# 확장 최적화 및 프로토스 대응 개선 보고서

날짜: 2026-01-24
전략: **최대 빠른 멀티 확장 (Maximum Fast Expansion)**

---

## 📋 요약

사용자 요청에 따라 봇의 전략을 **공격적 2-3베이스 전략**에서 **매크로 중심의 빠른 멀티 확장 전략**으로 완전히 전환했습니다.

### 주요 변경사항:
1. ✅ **프로토스 대응 시스템 구축** - DT, 오라클, 분열기 등 7가지 위협 대응
2. ✅ **확장 타이밍 초고속화** - 3베이스를 1.5분에 가져가는 공격적 확장
3. ✅ **일꾼 목표 대폭 증가** - 최대 110마리 (기존 45마리의 2.4배)
4. ✅ **다중 기지 자동 방어** - 모든 확장 기지에 자동 방어 구조물

---

## 🎯 1. 프로토스 대응 시스템 (NEW)

### 파일: `protoss_counter_system.py`

#### 구현된 7가지 대응 전략:

| 위협 유형 | 감지 조건 | 대응 방법 |
|---|---|---|
| **암흑 기사 (DT)** | DT 1기 이상 감지 | • 긴급 오버시어 변태 (최대 2기)<br>• 각 기지마다 긴급 포자 촉수<br>• 일꾼 대피 (10초 후 복귀) |
| **오라클** | 오라클 기지 근처 | • 일꾼 대피<br>• 퀸 대응 공격<br>• 포자 촉수 건설 |
| **불사조** | 불사조 2기 이상 | • 유닛 분산 (들어올리기 방지)<br>• 히드라/퀸 대공 공격 |
| **분열기** | 분열기 1기 이상 | • 유닛 방사형 분산 (3칸)<br>• 빠른 유닛으로 우회 공격 |
| **차원 분광기** | 분광기 감지 | • 즉시 모든 근처 병력 투입<br>• 우선 저격 |
| **불멸자** | 불멸자 2기 이상 | • 저글링 비율 40% (포위)<br>• 파멸충 비율 35% (담즙)<br>• 바퀴 비율 5% (약함!) |
| **보호막 충전소/파수기** | 전투 중 감지 | • 근처 병력 집중 공격<br>• 우선 타겟 제거 |

#### 통합:
- `wicked_zerg_bot_pro_impl.py`: 프로토스 카운터 초기화
- `bot_step_integration.py`: 매 스텝마다 실행

---

## 🚀 2. 최대 빠른 멀티 확장 시스템

### 2.1 확장 타이밍 최적화

**파일: `economy_manager.py`**

| 기지 수 | 기존 타이밍 | **새 타이밍** | 개선 |
|---|---|---|---|
| 1→2 (내츄럴) | 30초 | **30초** | 유지 |
| 2→3 | 210초 (3.5분) | **90초 (1.5분)** | ⚡ **2분 단축** |
| 3→4 | 300초 (5분) | **150초 (2.5분)** | ⚡ **2.5분 단축** |
| 4→5 | 390초 (6.5분) | **210초 (3.5분)** | ⚡ **3분 단축** |
| 5→6 | 480초 (8분) | **270초 (4.5분)** | ⚡ **3.5분 단축** |
| 6→7 | - | **330초 (5.5분)** | ✨ **새로 추가** |
| 7+ | - | **60초마다** | ✨ **무한 확장** |

#### 동시 확장 허용:
```python
# 미네랄에 따라 동시 확장 개수 조정
if minerals > 1000:
    max_pending = 3  # 최대 3개 동시
elif minerals > 600:
    max_pending = 2  # 최대 2개 동시
else:
    max_pending = 1
```

### 2.2 일꾼 목표 대폭 증가

**파일: `economy_combat_balancer.py`**

| 게임 단계 | 기존 목표 | **새 목표** | 증가율 |
|---|---|---|---|
| 초반 (0-6분) | 24마리 | **44마리** | +83% |
| 중반 (6-12분) | 45마리 | **88마리** | +96% |
| 후반 (12분+) | 45마리 | **110마리** | +144% |

**계산 로직:**
- 기지당 일꾼: 16 → **22마리** (미네랄 16 + 가스 6)
- 실제 ideal_harvesters 기반 자동 계산
- 포화 상태 체크로 과잉 생산 방지

### 2.3 경제 비중 증가

**파일: `economy_combat_balancer.py`**

드론 대 군대 생산 비율 조정:

| 시간 | 기존 비율 | **새 비율** | 변화 |
|---|---|---|---|
| 0-6분 | 70% 경제 | **75% 경제** | +5%p |
| 6-12분 | 50% 경제 | **60% 경제** | +10%p |
| 12분+ | 30% 경제 | **40% 경제** | +10%p |

---

## 🛡️ 3. 다중 기지 방어 시스템 (NEW)

### 파일: `multi_base_defense.py`

#### 3.1 기지별 자동 방어

**각 기지마다 자동 배치:**
- 스파인 크롤러: **2개**
- 포자 촉수: **1개** (3분 이후)
- 퀸: **2마리**

#### 3.2 위협 레벨 시스템

```python
def _calculate_threat_level(townhall) -> int:
    nearby_enemies = enemy_units.closer_than(15, townhall)

    if enemy_count == 0:
        return 0  # 안전
    elif enemy_count <= 3:
        return 1  # 경미한 위협
    elif enemy_count <= 8:
        return 2  # 중간 위협
    else:
        return 3  # 심각한 위협
```

#### 3.3 방어 우선순위

1. **공격 받는 기지** (threat_level >= 2)
2. **멀티 기지** (본진 아닌 확장)
3. **본진**

#### 3.4 긴급 방어 메커니즘

**중간 위협 (레벨 2):**
- 근처 모든 군대 유닛 투입 (20칸 이내)
- 공격 대상: 가장 가까운 적

**심각한 위협 (레벨 3):**
- 군대 유닛 + 일꾼 **최대 5마리** 투입
- 일꾼도 전투에 참여

#### 통합:
- `wicked_zerg_bot_pro_impl.py`: 다중 기지 방어 초기화
- `bot_step_integration.py`: 매 스텝마다 실행 (~2초마다 체크)

---

## 📊 4. 전략 비교

### 이전 전략: 공격적 2-3베이스 (30분 승리)

| 항목 | 값 |
|---|---|
| 목표 | 30분 이내 승리 |
| 최대 기지 | 3-4개 (제한적) |
| 일꾼 | 24-45마리 |
| 확장 타이밍 | 3분 30초 (3베이스) |
| 전략 | 공격 중심 |

### 새 전략: 매크로 중심 빠른 멀티

| 항목 | 값 |
|---|---|
| 목표 | 경제 우위 확보 |
| 최대 기지 | **무제한** (7+ 가능) |
| 일꾼 | **44-110마리** |
| 확장 타이밍 | **1분 30초** (3베이스) |
| 전략 | **경제 중심** |

---

## 🎮 5. 게임 플레이 예상 시나리오

### 타임라인:

**0:30** - 2베이스 (내츄럴)
- 드론 13마리 이상
- 스포닝 풀 건설 시작

**1:30** - 3베이스 (초고속!)
- 드론 ~24마리
- 첫 공격 유닛 생산 시작

**2:30** - 4베이스
- 드론 ~35마리
- 레어 완성 예정
- 가스 건물 추가

**3:30** - 5베이스
- 드론 ~50마리
- 히드라 덴 또는 로치 워렌 완성
- 첫 타이밍 공격 준비 (소규모)

**4:30** - 6베이스
- 드론 ~66마리
- 스파이어 완성
- 모든 기지에 방어 구조물 배치 완료

**5:30** - 7베이스
- 드론 ~88마리
- 하이브 테크 진입
- 강력한 타이밍 공격

**7:00+** - 무한 확장
- 드론 110마리 (완전 포화)
- 경제 우위 확보
- 압도적인 병력 생산

---

## 🔧 6. 주요 파일 변경사항

### 새로 생성된 파일:
1. **`protoss_counter_system.py`** (545줄)
   - 프로토스 7가지 위협 대응 시스템
   - 긴급 오버시어/포자 촉수 로직

2. **`multi_base_defense.py`** (318줄)
   - 다중 기지 자동 방어 시스템
   - 위협 레벨 계산 및 긴급 방어

### 수정된 파일:
1. **`economy_manager.py`** (Lines 677-715)
   - 확장 타이밍 초고속화
   - 동시 확장 허용 (최대 3개)

2. **`economy_combat_balancer.py`** (Lines 54-64, 272-278)
   - 일꾼 목표 대폭 증가 (44/88/110)
   - 경제 비중 증가 (75%/60%/40%)

3. **`wicked_zerg_bot_pro_impl.py`** (Lines 231-242)
   - 프로토스 카운터 초기화
   - 다중 기지 방어 초기화

4. **`bot_step_integration.py`** (Lines 419-432)
   - 프로토스 카운터 실행
   - 다중 기지 방어 실행

---

## ⚠️ 7. 주의사항 및 권장사항

### 주의사항:

1. **초반 방어 취약**
   - 빠른 확장으로 초반 병력이 적을 수 있음
   - 적의 올인 공격에 주의 필요
   - 다중 기지 방어 시스템이 자동으로 대응

2. **자원 관리**
   - 동시 확장으로 미네랄 소모가 큼
   - 미네랄 400 이하일 때는 확장 중단
   - 병력 생산과 균형 필요

3. **오버로드 서플라이**
   - 빠른 드론 생산으로 서플라이 블락 위험
   - 오버로드를 충분히 생산해야 함

### 권장사항:

1. **훈련 데이터 수집**
   - 새 전략으로 최소 20게임 훈련 필요
   - 종족별 승률 확인

2. **상대별 조정**
   - **vs 테란**: 빠른 확장 + 링/베인 압박
   - **vs 프로토스**: 프로토스 카운터 시스템 활용
   - **vs 저그**: 경제 경쟁 + 뮤탈 견제

3. **모니터링**
   - 일꾼 수 확인 (목표 대비)
   - 기지 방어 상태 확인
   - 자원 뱅킹 (3000+) 발생 시 병력 생산 증가

---

## 📈 8. 예상 성과

### 경제 우위:
- **6분 시점**: 상대보다 일꾼 +20마리 이상
- **10분 시점**: 상대보다 일꾼 +30마리 이상
- **15분 시점**: 압도적인 경제 우위

### 병력 생산:
- 후반 게임에서 상대보다 **2배 이상** 빠른 병력 생산
- 무한 유닛 리젠 가능
- 멀티 로스 후 빠른 재확장

### 승리 조건:
- 경제 우위 → 병력 우위 → 압도적 승리
- 상대의 멀티 파괴 후 재확장 차단
- 자원 고갈 전략

---

## 🚀 9. 다음 단계

1. ✅ **프로토스 대응 시스템 구현 완료**
2. ✅ **확장 타이밍 최적화 완료**
3. ✅ **다중 기지 방어 시스템 구현 완료**
4. ⏳ **훈련 및 성능 테스트 필요**
5. ⏳ **종족별 세부 조정 필요**

---

## 💡 10. 코드 예시

### 확장 타이밍 (economy_manager.py):
```python
# 2→3 베이스: 1분 30초 (초고속)
if base_count == 2:
    if game_time >= 90 or minerals > 400:
        should_expand = True
        expand_reason = "3rd base HYPER-FAST"

# 동시 확장 허용
max_pending = 3 if minerals > 1000 else 2 if minerals > 600 else 1
if pending >= max_pending:
    return
```

### 프로토스 DT 대응 (protoss_counter_system.py):
```python
if self.dt_detected:
    # 긴급 오버시어 변태
    await self._emergency_overseer_morph()

    # 긴급 포자 촉수
    await self._build_emergency_spore_crawlers()

    # 일꾼 대피
    if dt_near_base:
        await self._pull_workers_from_threat()
```

### 다중 기지 방어 (multi_base_defense.py):
```python
# 각 기지의 위협 레벨 계산
for th in townhalls:
    threat_level = self._calculate_threat_level(th)

    # 공격 받는 기지에 긴급 방어
    if threat_level >= 2:
        nearby_army = units.closer_than(20, th)
        for unit in nearby_army:
            unit.attack(closest_enemy)
```

---

**작성자**: Claude Sonnet 4.5
**날짜**: 2026-01-24
**버전**: 1.0
