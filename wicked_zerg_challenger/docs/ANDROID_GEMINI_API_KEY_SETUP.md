# Android Studio에서 Gemini API 키 설정하기

**작성 일시**: 2026-01-14  
**상태**: ? **설정 가이드 완료**

---

## ? Gemini API 키 설정 방법

Android 앱에서 Gemini API를 사용하려면 API 키를 안전하게 설정해야 합니다.

---

## 방법 1: local.properties 사용 (권장) ?

가장 안전한 방법입니다. `local.properties`는 Git에 커밋되지 않아 API 키가 노출되지 않습니다.

### 1단계: local.properties 파일 열기

1. **Android Studio에서 프로젝트 열기**
2. **프로젝트 뷰에서 `local.properties` 파일 찾기**
   - 위치: `monitoring/mobile_app_android/local.properties`
   - 프로젝트 루트에 있음

3. **파일 열기** (더블클릭)

### 2단계: API 키 추가

`local.properties` 파일에 다음을 추가:

```properties
# Gemini API Key
GEMINI_API_KEY=YOUR_API_KEY_HERE
```

**예시**:
```properties
# Gemini API Key
GEMINI_API_KEY=AIzaSyAbc123def456ghi789jkl012mno345pqr678
```

### 3단계: build.gradle.kts 수정

`app/build.gradle.kts` 파일을 열고 다음을 추가:

```kotlin
android {
    // ... 기존 설정 ...

    defaultConfig {
        // ... 기존 설정 ...
        
        // Load API key from local.properties
        val localProperties = java.util.Properties()
        val localPropertiesFile = rootProject.file("local.properties")
        if (localPropertiesFile.exists()) {
            localProperties.load(java.io.FileInputStream(localPropertiesFile))
        }
        
        val geminiApiKey = localProperties.getProperty("GEMINI_API_KEY") ?: ""
        
        buildConfigField("String", "GEMINI_API_KEY", "\"$geminiApiKey\"")
    }
    
    buildFeatures {
        viewBinding = true
        buildConfig = true  // BuildConfig 활성화
    }
}
```

### 4단계: 코드에서 사용

Kotlin 코드에서 API 키 사용:

```kotlin
import com.wickedzerg.mobilegcs.BuildConfig

class GeminiApiClient {
    private val apiKey = BuildConfig.GEMINI_API_KEY
    
    fun callGemini() {
        // API 키 사용
        println("API Key: $apiKey")
    }
}
```

---

## 방법 2: gradle.properties 사용

### 1단계: gradle.properties 파일 열기

위치: `monitoring/mobile_app_android/gradle.properties`

### 2단계: API 키 추가

```properties
# Gemini API Key
GEMINI_API_KEY=YOUR_API_KEY_HERE
```

### 3단계: build.gradle.kts 수정

```kotlin
android {
    defaultConfig {
        val geminiApiKey = project.findProperty("GEMINI_API_KEY") as String? ?: ""
        buildConfigField("String", "GEMINI_API_KEY", "\"$geminiApiKey\"")
    }
    
    buildFeatures {
        buildConfig = true
    }
}
```

---

## 방법 3: 환경 변수 사용

### 1단계: 환경 변수 설정

**Windows (PowerShell)**:
```powershell
$env:GEMINI_API_KEY="YOUR_API_KEY_HERE"
```

**Windows (CMD)**:
```cmd
set GEMINI_API_KEY=YOUR_API_KEY_HERE
```

**Linux/Mac**:
```bash
export GEMINI_API_KEY="YOUR_API_KEY_HERE"
```

### 2단계: build.gradle.kts 수정

```kotlin
android {
    defaultConfig {
        val geminiApiKey = System.getenv("GEMINI_API_KEY") ?: ""
        buildConfigField("String", "GEMINI_API_KEY", "\"$geminiApiKey\"")
    }
    
    buildFeatures {
        buildConfig = true
    }
}
```

---

## ? 보안 주의사항

### ? 하지 말아야 할 것

1. **코드에 직접 API 키 작성 금지**:
   ```kotlin
   // ? 절대 이렇게 하지 마세요!
   private val apiKey = "AIzaSyAbc123def456..."
   ```

2. **Git에 API 키 커밋 금지**:
   - `local.properties`는 이미 `.gitignore`에 포함되어 있음
   - 확인: `.gitignore`에 `local.properties`가 있는지 확인

### ? 안전한 방법

1. **local.properties 사용** (권장)
   - Git에 커밋되지 않음
   - 각 개발자마다 다른 키 사용 가능

2. **BuildConfig 사용**
   - 빌드 시점에 키가 삽입됨
   - 릴리즈 빌드 시 ProGuard로 난독화 가능

---

## ? 완전한 설정 예시

### 1. local.properties 파일

```properties
# This file is automatically generated by Android Studio.
# Do not modify this file -- YOUR CHANGES WILL BE ERASED!
#
# This file should *NOT* be checked into Version Control Systems,
# as it contains information specific to your local configuration.
#
# Location of the SDK. This is only used by Gradle.
# For customization when using a Version Control System, please read the
# header note.
sdk.dir=C\:\\Users\\YourName\\AppData\\Local\\Android\\Sdk

# Gemini API Key (DO NOT COMMIT TO GIT)
GEMINI_API_KEY=AIzaSyAbc123def456ghi789jkl012mno345pqr678
```

### 2. build.gradle.kts 파일

```kotlin
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

android {
    namespace = "com.wickedzerg.mobilegcs"
    compileSdk = 34

    defaultConfig {
        applicationId = "com.wickedzerg.mobilegcs"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
        
        // Load API key from local.properties
        val localProperties = java.util.Properties()
        val localPropertiesFile = rootProject.file("local.properties")
        if (localPropertiesFile.exists()) {
            localProperties.load(java.io.FileInputStream(localPropertiesFile))
        }
        
        val geminiApiKey = localProperties.getProperty("GEMINI_API_KEY") ?: ""
        
        buildConfigField("String", "GEMINI_API_KEY", "\"$geminiApiKey\"")
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    buildFeatures {
        viewBinding = true
        buildConfig = true  // BuildConfig 활성화
    }
}

// ... dependencies ...
```

### 3. Kotlin 코드에서 사용

```kotlin
package com.wickedzerg.mobilegcs

import com.wickedzerg.mobilegcs.BuildConfig
import com.google.generativeai.GenerativeModel

class GeminiService {
    private val apiKey = BuildConfig.GEMINI_API_KEY
    
    fun initializeGemini() {
        if (apiKey.isNotEmpty()) {
            val model = GenerativeModel(
                modelName = "gemini-1.5-flash",
                apiKey = apiKey
            )
            // Gemini 사용
        } else {
            println("API Key not found!")
        }
    }
}
```

---

## ? API 키 확인 방법

### Gemini API 키 발급

1. **Google AI Studio 접속**
   - https://makersuite.google.com/app/apikey
   - 또는 https://aistudio.google.com/app/apikey

2. **API 키 생성**
   - "Create API Key" 클릭
   - Google 계정 로그인
   - API 키 복사

3. **API 키 형식**
   - `AIzaSy...`로 시작하는 긴 문자열
   - 예: `AIzaSyAbc123def456ghi789jkl012mno345pqr678`

---

## ? 설정 확인

### 1. BuildConfig 생성 확인

빌드 후 다음 위치에서 확인:
```
app/build/generated/source/buildConfig/debug/com/wickedzerg/mobilegcs/BuildConfig.java
```

내용 확인:
```java
public final class BuildConfig {
    public static final String GEMINI_API_KEY = "YOUR_API_KEY";
    // ...
}
```

### 2. 코드에서 테스트

```kotlin
import com.wickedzerg.mobilegcs.BuildConfig

// API 키가 제대로 로드되었는지 확인
Log.d("API", "Key loaded: ${BuildConfig.GEMINI_API_KEY.isNotEmpty()}")
```

---

## ? 문제 해결

### API 키가 비어있음

**원인**: `local.properties`에 키가 없거나 잘못된 이름

**해결**:
1. `local.properties` 파일 확인
2. `GEMINI_API_KEY` 이름이 정확한지 확인
3. Gradle 동기화 재실행 (File > Sync Project with Gradle Files)

### BuildConfig가 생성되지 않음

**원인**: `buildConfig = true`가 설정되지 않음

**해결**:
1. `build.gradle.kts`에서 `buildFeatures { buildConfig = true }` 확인
2. Gradle 동기화 재실행
3. 프로젝트 클린 후 재빌드: `Build > Clean Project`, `Build > Rebuild Project`

### API 키가 Git에 커밋됨

**원인**: `.gitignore`에 `local.properties`가 없음

**해결**:
1. `.gitignore` 파일 확인
2. 다음이 포함되어 있는지 확인:
   ```
   local.properties
   *.properties
   ```
3. 이미 커밋된 경우: Git에서 제거하고 다시 커밋

---

## ? 관련 문서

- **Gemini API 문서**: https://ai.google.dev/docs
- **Android BuildConfig**: https://developer.android.com/reference/android/os/BuildConfig
- **안전한 API 키 관리**: https://developer.android.com/studio/publish/app-signing

---

## ? 완료!

이제 Android 앱에서 Gemini API를 안전하게 사용할 수 있습니다!

**다음 단계**:
1. `local.properties`에 API 키 추가
2. `build.gradle.kts` 수정
3. Gradle 동기화
4. 코드에서 `BuildConfig.GEMINI_API_KEY` 사용
